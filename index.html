<!DOCTYPE html>   
<html>
    <html lang ="fr">
        <head>
            <meta charset ="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <link rel="stylesheet" href="index.css">
            <script async src="https://ga.jspm.io/npm:es-module-shims@1.5.1/dist/es-module-shims.js" crossorigin="anonymous"></script>
            <script type="importmap">
                {
                  "imports": {
                    "three": "https://cdn.jsdelivr.net/npm/three@0.174.0/build/three.module.js",
                    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.174.0/examples/jsm/"
                  }
                }
              </script>

            <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>

            <!-- Three.js -->
            <script type="module">

                import * as THREE from "three";
                import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";

                // Initialisation de la sc√®ne
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);

                //Shaders
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap; // Ombres douces

                // Charger le fond dynamique de la page (visible au d√©but)
                const body = document.querySelector("body");
                const currentBackgroundImage = getComputedStyle(body).backgroundImage;
                const imageUrl = currentBackgroundImage.slice(4, -1).replace(/"/g, "");

                // Variables de gestion du fond
                let galaxyBackground;
                let galaxyMaterial;

                // Texture du fond
                const textureLoader = new THREE.TextureLoader();
                textureLoader.load(
                    imageUrl,
                    (texture) => {
                        scene.background = texture;
                        console.log("Texture charg√©e avec succ√®s");
                    },
                    undefined,
                    (error) => {
                        console.error("Erreur lors du chargement de la texture:", error);
                    }
                );

                // Fonction pour charger le mod√®le 3D
                let model3D;

                function loadModel3D() {
                    const loader = new GLTFLoader();
                    loader.load("https://tigreblack.github.io/threejs_room/scene.gltf", function (gltf) {
                        model3D = gltf.scene;
                        scene.add(model3D);

                        // üåü V√©rifier et modifier les mat√©riaux
                        model3D.traverse((child) => {
                            if (child.isMesh) {
                                // Activer les ombres
                                child.castShadow = true;
                                child.receiveShadow = true;

                                // V√©rifier si le mat√©riau est compatible avec la lumi√®re
                                if (child.material && !(child.material instanceof THREE.MeshStandardMaterial)) {
                                    child.material = new THREE.MeshStandardMaterial({
                                        color: child.material.color || 0xffffff,
                                        roughness: 0.5,  // Ajuste la rugosit√© pour un effet plus naturel
                                        metalness: 0.2,  // Ajoute un l√©ger effet brillant
                                    });
                                }
                            } else {
                                console.log("mod√®le qui supporte pas la lumi√®re")
                            }
                        });

                        // Centrer le mod√®le
                        const box = new THREE.Box3().setFromObject(model3D);
                        const center = box.getCenter(new THREE.Vector3());
                        model3D.position.sub(center);

                        // Ajuster la cam√©ra
                        camera.position.set(6, 7, -8); // Place la cam√©ra √† distance du mod√®le
                        camera.lookAt(0, 3, 0);  // Regarde le centre de la sc√®ne

                        console.log("Mod√®le charg√© avec succ√®s !");
                        
                        // Une fois le mod√®le charg√©, d√©marrer la transition de la galaxie
                        startGalaxyTransition();
                    });

                    // Lumi√®re directionnelle (simulant une source comme une √©toile)
                    const directionalLight = new THREE.DirectionalLight(0xfff8e3, 1.3);  // Couleur et intensit√©
                    directionalLight.position.set(6, 7, -8);  // Position de la lumi√®re
                    directionalLight.castShadow = true;  // Permet de caster des ombres

                    scene.add(directionalLight);

                    const hemiLight = new THREE.HemisphereLight(0xffeeb1, 0x080820, 0.5); // Lumi√®re chaude + fond sombre
                    scene.add(hemiLight);

                    //Lumi√®re ponctuelle (simule une lampe de chevet ou une LED)
                    const pointLight = new THREE.PointLight(0xffaa33, 1, 10); // Couleur chaude + intensit√© forte + port√©e courte
                    pointLight.position.set(2, 3, 1); // Position pr√®s d'un coin de la chambre
                    pointLight.castShadow = true;
                    scene.add(pointLight);

                    // Ajout d'une lumi√®re d'appoint pour l'ambiance
                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);  // Lumi√®re douce
                    scene.add(ambientLight);

                    const lightHelper = new THREE.PointLightHelper(pointLight)
                    scene.add(lightHelper)
                }

                // Cr√©ation d'une Skybox Galaxie r√©aliste (cach√©e au d√©part)
                function startGalaxyTransition() {
                    // Cr√©er la galaxie uniquement apr√®s que le mod√®le ait √©t√© charg√©
                    const galaxyTexture = textureLoader.load("https://tigreblack.github.io/threejs_room/galaxy.jpg");
                    const galaxyGeometry = new THREE.SphereGeometry(50, 24, 24);
                    const galaxyMaterial = new THREE.MeshBasicMaterial({
                        map: galaxyTexture,
                        side: THREE.BackSide,
                        transparent: true,
                        opacity: 0 // Initialement cach√©e
                    });

                    galaxyMaterial.map = galaxyTexture;
                    galaxyMaterial.needsUpdate = true; // Forcer la mise √† jour

                    galaxyBackground = new THREE.Mesh(galaxyGeometry, galaxyMaterial);
                    scene.add(galaxyBackground);

                    // Transition de la galaxie : l'afficher progressivement
                    gsap.to(galaxyMaterial, {
                        opacity: 1,
                        duration: 1.5,
                        ease: "power2.inOut"
                    });
                }

                function addStar(){
                    const stargeometry = new THREE.SphereGeometry(0.25, 24 ,24);
                    const starmaterial = new THREE.MeshBasicMaterial( {color: 0xffffff})
                    const star = new THREE.Mesh(stargeometry,starmaterial);

                    const[x,y,z] = Array(3).fill().map(() => THREE.MathUtils.randFloatSpread(100));

                    star.position.set(x,y,z);
                    scene.add(star)
                }

                Array(200).fill().forEach(addStar)

                // √âcouteur d'√©v√©nement de scroll
                let scrollPosition = 0; // Position de la cam√©ra en fonction du scroll
                window.addEventListener('scroll', (event) => {
                    const scrollPercentage = (window.scrollY + window.innerHeight) / document.body.scrollHeight;

                    // Contr√¥le la position de la cam√©ra en fonction du scroll
                    scrollPosition = scrollPercentage * 100; // Jauge de la position du scroll (0-100)

                    // D√©placer la cam√©ra pour r√©v√©ler des sections
                    const maxScroll = 100;  // Le point maximum o√π la cam√©ra peut se d√©placer
                    const cameraZ = 5 - scrollPosition / 20;  // D√©placer la cam√©ra sur l'axe Z (plus la cam√©ra avance, plus elle est proche)
                    camera.position.set(0, 1.5, cameraZ); // Mise √† jour de la position de la cam√©ra
                    camera.lookAt(0, 1.5, 0); // Garder la cam√©ra focalis√©e sur la sc√®ne

                    // Animation de la sc√®ne
                    renderer.render(scene, camera);

                    // Si la cam√©ra est dans la section des projets, afficher une pop-up
                    if (scrollPosition > 50) { // Si on d√©passe 50% du scroll, afficher la pop-up
                        displayPopup();
                    }
                });

                // Fonction pour afficher la pop-up des projets
                function displayPopup() {
                    const popup = document.getElementById('project-popup');
                    if (popup) {
                        popup.style.display = 'block';
                    }
                }

                // Initialisation de l'animation
                function animate() {
                    requestAnimationFrame(animate);

                    // Animation de la sc√®ne
                    renderer.render(scene, camera);

                }
                animate();

                // G√©rer la mise √† jour lors du redimensionnement de la fen√™tre
                window.addEventListener('resize', () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });

                // Fonction pour la transition Nuage
                function startCloudTransition() {
                    const siteVitrine = document.getElementById("site-vitrine");
                    const espace3D = document.getElementById("espace-3d");
                    const cloudEffect = document.getElementById("cloudEffect");

                    if (!siteVitrine || !espace3D || !cloudEffect) {
                        console.error("Un des √©l√©ments est introuvable !");
                        return;
                    }

                    gsap.set(cloudEffect, { zIndex: 10 });
                    cloudEffect.innerHTML = "";

                    const numClouds = 10;
                    let clouds = [];
                    let completedClouds = 0;

                    for (let i = 0; i < numClouds; i++) {
                        let cloud = document.createElement("img");
                        cloud.src = `cloud${(i % 3) + 1}.png`;
                        cloud.classList.add("cloud");
                        cloud.style.width = `${Math.random() * 1800 + 1800}px`;
                        cloud.style.top = `${Math.random() * 110}vh`;
                        cloud.style.left = `${Math.random() * 1.5}vw`;
                        cloudEffect.appendChild(cloud);
                        clouds.push(cloud);

                        gsap.to(cloud, {
                            opacity: 1,
                            scale: 1.5,
                            duration: 1.5,
                            ease: "power2.inOut",
                            onComplete: () => {
                                completedClouds++;

                                if (completedClouds === numClouds) {
                                    console.log("Tous les nuages sont visibles, suppression de l'arri√®re-plan");
                                    scene.background = null;
                                    renderer.render(scene, camera);

                                    gsap.to(siteVitrine, {
                                        opacity: 0,
                                        duration: 1,
                                        onComplete: () => {
                                            siteVitrine.style.display = "none";
                                            espace3D.style.display = "block";

                                            gsap.to(clouds, {
                                                opacity: 0,
                                                scale: 2,
                                                x: () => (Math.random() - 0.5) * 2000,
                                                y: () => (Math.random() - 0.5) * 1000,
                                                duration: 2,
                                                stagger: 0.2,
                                                ease: "power2.inOut",
                                                onComplete: () => {
                                                    cloudEffect.innerHTML = "";
                                                    gsap.set(cloudEffect, { zIndex: -1 });
                                                    loadModel3D(); // Charger le mod√®le apr√®s la transition des nuages
                                                }
                                            });
                                        }
                                    });
                                }
                            }
                        });
                    }
                }

                // Ajouter l'√©v√©nement pour d√©marrer la transition
                document.getElementById("breakBtn").addEventListener("click", startCloudTransition);

            </script>
            
            <style>
                .toast {
                    position: fixed;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(45, 44, 88, 0.95);
                    color: white;
                    padding: 1rem 2rem;
                    border-radius: 8px;
                    border: 2px solid #6e6ed7;
                    font-family: 'Press Start 2P', cursive;
                    font-size: 14px;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                    z-index: 1000;
                }
                .toast.show {
                    opacity: 1;
                }
            </style>
            <title>DODE Lucas</title>
        </head>
        <body>
            <div id="toast" class="toast"></div>
            <div container0>
                <!-- Site vitrine -->
                <div id="site-vitrine">
                    <!--Header avec les informations importantes-->
                    <div class="header">
                        <header>
                            <span class="pseudoname">DODE Lucas</span>
                        </header>
                            <span class="inline-info">
                            <ul>
                                <li><a href="mailto:lucas.dode26@gmail.com">lucas.dode26@gmail.com</a></li>
                                <li><a>07 83 98 57 85</a></li>
                                <li><a href ="./coding_V2/CV.pdf">CV</a></li>
                            </ul>
                        </span>
                    </div>

                    <!-- Les tuiles -->
                    <div class="menu-container">
                        <a href="STAGE_CV.html" class="tile tile1">Stage<br>formations<br>& CV</a>
                        <a href="./coding_V2/loadingcoding.html" class="tile tile2">Informatique</a>
                        <a href="#" class="tile tile3 construction">Art<br>& Illustration</a>
                        <a href="#" class="tile tile4 construction">Projet personnel</a>
                    </div>

                </div>

                <!-- Effet de nuages (au-dessus du site vitrine mais invisible au d√©but) -->
                <div id="cloudEffect">
                    <img src="cloud1.png" class="cloud" id="cloud1">
                    <img src="cloud2.png" class="cloud" id="cloud2">
                    <img src="cloud3.png" class="cloud" id="cloud3">
                </div>
                
                <!-- Espace 3D -->
            <div id="espace-3d" style="display: none;"></div>
            <script>
                function showToast(message, duration = 2000) {
                    const toast = document.getElementById('toast');
                    toast.textContent = message;
                    toast.classList.add('show');
                    setTimeout(() => {
                        toast.classList.remove('show');
                    }, duration);
                }

                // Gestionnaire pour les sections en construction
                document.addEventListener('DOMContentLoaded', () => {
                    const constructionTiles = document.querySelectorAll('.tile.construction');
                    constructionTiles.forEach(tile => {
                        tile.addEventListener('click', (e) => {
                            e.preventDefault();
                            const isArt = tile.classList.contains('tile3');
                            const message = isArt ? 
                                'üöß Section Art & Illustration en construction...' : 
                                'üöß Section Projets personnels en construction...';
                            showToast(message);
                        });
                    });
                });

                /* Pour r√©activer l'effet cloud plus tard :
                function startCloudTransition() {
                    const siteVitrine = document.getElementById("site-vitrine");
                    const espace3D = document.getElementById("espace-3d");
                    const cloudEffect = document.getElementById("cloudEffect");
                    // ... le reste du code cloud ...
                }
                */
            </script>
        </div>
    </body>
</html>